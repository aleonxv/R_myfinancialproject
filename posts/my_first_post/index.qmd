---
title: "Following the Money: Uncovering Financial Insights from U.S. State Budgets"
author: "Angel Leon"
date: "2025-08-07"
categories: [finance,data analysis]
---

# Financial Investment by State

I decided to take a look at financial data across several years throughout the US, there are conclusions that I draw based on some metrics that I would like to focus on. To do so, I began to look at some important questions to figure out how spending per capita is reflected in some of the other variables. I also took a look at how trends in spending across some states have changed over the years and highlighted notable information or trends that take place.\
\
The questions are as follows:

-   **How does spending per capita on education affect the amount that a state will spend on policing?**

-   **How do total expenditures on different sectors change in relation to a state's total revenue over time?**\

## Predictions:

Based on the data, I believe that spending per capita on education will likely see a decrease in the amount that is needed to be spent on policing. I also believe that there will be a trend where the plot points become

I believe that based on the information on the data set, I think that it will be likely to see that there will be a sharp increase in education after about the year 2000, I also think that there will be a steady increase across all expenditure not because there is necessarily a lot more spending but because as everything gradually becomes slightly more expensive this trend will follow.\
\

# Approach:

For this data analysis, I have gathered information using two separate databases, one is a financial database from the CORGIS Dataset Project which derives its data from The Annual Survey of Government Finances. The second database is from GitHub user "jakevdp" that compiled data from the US Census Bureau and Wikipedia. The first data set ranges from 1992-2019 across all states, includes 30 columns and 1052 rows including information about expenditures across education, policing, correction, and health care. The second data set is 4 columns and 2545 rows and includes information about the state population via census as well as information about the population that is under 18.

## Education and Police Spending

```{r}
#| echo: true
# Load the necessary libraries for data manipulation and visualization
# Suppress the package startup messages from tidyverse
suppressPackageStartupMessages(library(tidyverse))

# Define a function to calculate the equation for per capita spending
# This function takes the total spending and population as input
per_capita_equation <- function(total_spending, population) {
  return(total_spending / population)
}

# Load the finance and population datasets
# Make sure these files are in the same directory as your R script
finance_df <- read.csv("../../finance.csv")
population_df <- read.csv("../../state-population.csv")

# Filter the population data to get only the total population for each state and year
total_population_df <- population_df %>%
  filter(ages == "total") %>%
  select(state_abbr = `state.region`, year, population)

# Create a mapping from full state names to abbreviations to fix the join issue
state_name_map <- data.frame(
  State = c("ALABAMA", "ALASKA", "ARIZONA", "ARKANSAS", "CALIFORNIA", "COLORADO", "CONNECTICUT", "DELAWARE", "FLORIDA", "GEORGIA", "HAWAII", "IDAHO", "ILLINOIS", "INDIANA", "IOWA", "KANSAS", "KENTUCKY", "LOUISIANA", "MAINE", "MARYLAND", "MASSACHUSETTS", "MICHIGAN", "MINNESOTA", "MISSISSIPPI", "MISSOURI", "MONTANA", "NEBRASKA", "NEVADA", "NEW HAMPSHIRE", "NEW JERSEY", "NEW MEXICO", "NEW YORK", "NORTH CAROLINA", "NORTH DAKOTA", "OHIO", "OKLAHOMA", "OREGON", "PENNSYLVANIA", "RHODE ISLAND", "SOUTH CAROLINA", "SOUTH DAKOTA", "TENNESSEE", "TEXAS", "UTAH", "VERMONT", "VIRGINIA", "WASHINGTON", "WEST VIRGINIA", "WISCONSIN", "WYOMING"),
  state_abbr = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
)

# Clean up the finance column names and join with the state abbreviation map
finance_with_abbr <- finance_df %>%
  rename(state = State, year = Year) %>%
  left_join(state_name_map, by = c("state" = "State"))

# Join the combined finance data with the population data using the new abbreviation column
combined_df <- finance_with_abbr %>%
  left_join(total_population_df, by = c("state_abbr" = "state_abbr", "year")) %>%
  drop_na(population)

# Calculate the per capita spending for education and policing
combined_df <- combined_df %>%
  mutate(
    per_capita_education_spending = per_capita_equation(`Details.Education.Education.Total`, population),
    per_capita_policing_spending = per_capita_equation(`Details.Police.protection`, population)
  )


combined_df$year_factor <- "1990s"
combined_df[combined_df$year > 1999, ]$year_factor <- "2000s"

# Create a scatter plot to compare per capita spending on education and policing
# Use capture.output to suppress any messages or warnings
capture.output({
  suppressMessages(
    suppressWarnings(
      ggplot(combined_df, aes(x = per_capita_education_spending, y = per_capita_policing_spending, color = year_factor)) +
        geom_point(alpha = 0.6) +
        geom_smooth(method = "lm", se = FALSE) +
        labs(
          title = "Per Capita Spending: Education vs. Policing",
          subtitle = "The blue line represents the linear trend (line of best fit).",
          x = "Per Capita Education Spending (in US Dollars)",
          y = "Per Capita Policing Spending (in US Dollars)"
        ) +
        theme_minimal()
    )
  )
})
```

Overall based on the data, policing expenditure goes down with a few outliers and while it is scattered around the lower end of spending there is a drop off in the expenditure right around the \$3 mark. What this says is that when a state invest more money into education per person, it is more likely that they will spend less money on policing. While this does not tell the entire story, it is reasonable to conclude that education can have an impact on the amount of policing that a state will need.

# Financial Expenditure Trends

```{r}
#| echo: true
# Load the necessary libraries for data manipulation and visualization.
# The suppressPackageStartupMessages function ensures no package-related messages are shown.
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(scales)) # Load the scales package for advanced label formatting

# Load the finance dataset from the provided CSV file.
finance_df <- read.csv("../../finance.csv")

# Clean the column names for easier use in R.
# R automatically replaces spaces with periods in column headers, so we need to account for that.
finance_df_cleaned <- finance_df %>%
  rename(
    state = State,
    year = Year,
    total_revenue = Totals.Revenue,
    total_expenditure = Totals.Expenditure,
    education_expenditure = Details.Education.Education.Total,
    health_expenditure = Details.Health.Health.Total.Expenditure,
    correction_expenditure = Details.Correction.Correction.Total
  )

# Filter the data for a few example states to make the plot readable.
# This makes it easier to see individual trends without cluttering the graph.
selected_states_df <- finance_df_cleaned %>%
  filter(state %in% c("CALIFORNIA", "TEXAS", "NEW YORK")) %>%
  select(
    state,
    year,
    total_revenue,
    education_expenditure,
    health_expenditure,
    correction_expenditure
  )

# Reshape the data from a "wide" format to a "long" format for plotting.
# This stacks the different expenditure types into a single column, which ggplot2
# can then use to create multiple lines on the same plot.
long_format_df <- selected_states_df %>%
  pivot_longer(
    cols = c(total_revenue, education_expenditure, health_expenditure, correction_expenditure),
    names_to = "financial_category",
    values_to = "amount"
  )

# -------------------------------------------------------------------------
# First Graph: Total Revenue Trends
# This graph plots only the total revenue on a single, unified scale.
# The print() function is used to force this plot to be displayed in the output.
# -------------------------------------------------------------------------
suppressMessages(
  suppressWarnings(
    print(ggplot(
      long_format_df %>% filter(financial_category == "total_revenue"),
      aes(x = year, y = amount, color = financial_category)
    ) +
      geom_line(linewidth = 1.2) +
      facet_wrap(~ state) +
      scale_color_manual(
        values = c("total_revenue" = "darkgreen"),
        labels = c("Total Revenue")
      ) +
      scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, prefix = "$", suffix = "B")) +
      labs(
        title = "State Financial Trends: Total Revenue",
        subtitle = "Trends in California, Texas, and New York from 1992 to 2016",
        x = "Year",
        y = "Amount (in Billions of US Dollars)",
        color = "Financial Category"
      ) +
      theme_minimal(base_size = 14) +
      theme(legend.position = "bottom")
  ))
)

# -------------------------------------------------------------------------
# Second Graph: Key Expenditures Trends
# This graph plots the three expenditure categories with a free y-axis scale.
# The print() function is also used here to ensure this plot is displayed.
# -------------------------------------------------------------------------
suppressMessages(
  suppressWarnings(
    print(ggplot(
      long_format_df %>% filter(financial_category != "total_revenue"),
      aes(x = year, y = amount, color = financial_category)
    ) +
      geom_line(linewidth = 1.2) +
      facet_wrap(~ state, scales = "free_y") +
      scale_color_manual(
        values = c("education_expenditure" = "blue",
                   "health_expenditure" = "red",
                   "correction_expenditure" = "orange"),
        labels = c("Education", "Health", "Correction")
      ) +
      scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, prefix = "$", suffix = "B")) +
      labs(
        title = "State Financial Trends: Key Expenditures",
        subtitle = "Trends in California, Texas, and New York from 1992 to 2016",
        x = "Year",
        y = "Amount (in Billions of US Dollars)",
        color = "Financial Category"
      ) +
      theme_minimal(base_size = 14) +
      theme(legend.position = "bottom")
  ))
)

```

\
