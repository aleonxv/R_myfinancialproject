---
title: "Following the Money: Uncovering Financial Insights from U.S. State Budgets"
author: "Angel Leon"
date: "2025-08-07"
categories: [finance,data analysis]
---

# Financial Investment by State

I decided to take a look at financial data across several years throughout the US, there are conclusions that I draw based on some metrics that I would like to focus on. To do so, I began to look at some important questions to figure out how spending per capita is reflected in some of the other variables. I also took a look at how trends in spending across some states have changed over the years and highlighted notable information or trends that take place.\
\
The questions are as follows:

-   **How does spending per capita on education affect the amount that a state will spend on policing?**

-   **How do total expenditures on different sectors change in relation to a state's total revenue over time?**\

## Predictions:

Based on the data, I believe that spending per capita on education will likely see a decrease in the amount that is needed to be spent on policing. This is because I think that states investing more money into their residents for education will reduce the need of policing since more time will be allocated focusing on activities related to education and as will lead to less criminal activity.

I believe that based on the information on the data set, I think that it will be likely to see that there will be a sharp increase in education after about the year 2000, I also think that there will be a steady increase across all expenditure not because there is necessarily a lot more spending but because as everything gradually becomes slightly more expensive this trend will follow. I think that California will have the highest spending on education while Texas will have the highest spending on correction. Healthcare may be different but I predict that California will have the highest amount of expenditure just because they have more people that live in the state.\
\

# Approach:

For this data analysis, I have gathered information using two separate databases, one is a financial database from the CORGIS Dataset Project which derives its data from The Annual Survey of Government Finances. The second database is from GitHub user "jakevdp" that compiled data from the US Census Bureau and Wikipedia. The first data set ranges from 1992-2019 across all states, includes 30 columns and 1052 rows including information about expenditures across education, policing, correction, and health care. The second data set is 4 columns and 2545 rows and includes information about the state population via census as well as information about the population that is under 18.

## Education and Police Spending

```{r}
#| echo: true
# Load the necessary libraries for data manipulation and visualization
# Suppress the package startup messages from tidyverse
suppressPackageStartupMessages(library(tidyverse))

# Define a function to calculate the equation for per capita spending
# This function takes the total spending and population as input
per_capita_equation <- function(total_spending, population) {
  return(total_spending / population)
}

# Load the finance and population datasets
# Make sure these files are in the same directory as your R script
finance_df <- read.csv("../../finance.csv")
population_df <- read.csv("../../state-population.csv")

# Filter the population data to get only the total population for each state and year
total_population_df <- population_df %>%
  filter(ages == "total") %>%
  select(state_abbr = `state.region`, year, population)

# Create a mapping from full state names to abbreviations to fix the join issue
state_name_map <- data.frame(
  State = c("ALABAMA", "ALASKA", "ARIZONA", "ARKANSAS", "CALIFORNIA", "COLORADO", "CONNECTICUT", "DELAWARE", "FLORIDA", "GEORGIA", "HAWAII", "IDAHO", "ILLINOIS", "INDIANA", "IOWA", "KANSAS", "KENTUCKY", "LOUISIANA", "MAINE", "MARYLAND", "MASSACHUSETTS", "MICHIGAN", "MINNESOTA", "MISSISSIPPI", "MISSOURI", "MONTANA", "NEBRASKA", "NEVADA", "NEW HAMPSHIRE", "NEW JERSEY", "NEW MEXICO", "NEW YORK", "NORTH CAROLINA", "NORTH DAKOTA", "OHIO", "OKLAHOMA", "OREGON", "PENNSYLVANIA", "RHODE ISLAND", "SOUTH CAROLINA", "SOUTH DAKOTA", "TENNESSEE", "TEXAS", "UTAH", "VERMONT", "VIRGINIA", "WASHINGTON", "WEST VIRGINIA", "WISCONSIN", "WYOMING"),
  state_abbr = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY")
)

# Clean up the finance column names and join with the state abbreviation map
finance_with_abbr <- finance_df %>%
  rename(state = State, year = Year) %>%
  left_join(state_name_map, by = c("state" = "State"))

# Join the combined finance data with the population data using the new abbreviation column
combined_df <- finance_with_abbr %>%
  left_join(total_population_df, by = c("state_abbr" = "state_abbr", "year")) %>%
  drop_na(population)

# Calculate the per capita spending for education and policing
combined_df <- combined_df %>%
  mutate(
    per_capita_education_spending = per_capita_equation(`Details.Education.Education.Total`, population),
    per_capita_policing_spending = per_capita_equation(`Details.Police.protection`, population)
  )


combined_df$year_factor <- "1990s"
combined_df[combined_df$year > 1999, ]$year_factor <- "2000s"

# Create a scatter plot to compare per capita spending on education and policing
# Use capture.output to suppress any messages or warnings
capture.output({
  suppressMessages(
    suppressWarnings(
      ggplot(combined_df, aes(x = per_capita_education_spending, y = per_capita_policing_spending, color = year_factor)) +
        geom_point(alpha = 0.6) +
        geom_smooth(method = "lm", se = FALSE) +
        labs(
          title = "Per Capita Spending: Education vs. Policing",
          subtitle = "The blue line represents the linear trend (line of best fit).",
          x = "Per Capita Education Spending (in US Dollars)",
          y = "Per Capita Policing Spending (in US Dollars)"
        ) +
        theme_minimal()
    )
  )
})
```

Overall based on the data, policing expenditure goes up with a few outliers and while it is scattered around the lower end of spending there is a rise in the amount of money spent on policing when education spending goes up. What this says is that when a state invest more money into education per person, it is more likely that they will spend moremoney on policing. While this does not tell the entire story, it is reasonable to conclude that education can have an impact on the amount of policing that a state will spend per capita. This may be due to the fact that when there is more education there may be a positive correlation towards income meaning that the states are able to collect more money in taxes to spend on policing.

# Financial Expenditure Trends

```{r}
#| echo: true
# Load the necessary libraries for data manipulation and visualization.
# The suppressPackageStartupMessages function ensures no package-related messages are shown.
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(scales)) # Load the scales package for advanced label formatting

# Load the finance dataset from the provided CSV file.
finance_df <- read.csv("../../finance.csv")

# Clean the column names for easier use in R.
# R automatically replaces spaces with periods in column headers, so we need to account for that.
finance_df_cleaned <- finance_df %>%
  rename(
    state = State,
    year = Year,
    total_revenue = Totals.Revenue,
    total_expenditure = Totals.Expenditure,
    education_expenditure = Details.Education.Education.Total,
    health_expenditure = Details.Health.Health.Total.Expenditure,
    correction_expenditure = Details.Correction.Correction.Total
  )

# Filter the data for a few example states to make the plot readable.
# This makes it easier to see individual trends without cluttering the graph.
selected_states_df <- finance_df_cleaned %>%
  filter(state %in% c("CALIFORNIA", "TEXAS", "NEW YORK")) %>%
  select(
    state,
    year,
    total_revenue,
    education_expenditure,
    health_expenditure,
    correction_expenditure
  )

# Reshape the data from a "wide" format to a "long" format for plotting.
# This stacks the different expenditure types into a single column, which ggplot2
# can then use to create multiple lines on the same plot.
long_format_df <- selected_states_df %>%
  pivot_longer(
    cols = c(total_revenue, education_expenditure, health_expenditure, correction_expenditure),
    names_to = "financial_category",
    values_to = "amount"
  )

# -------------------------------------------------------------------------
# First Graph: Total Revenue Trends
# This graph plots only the total revenue on a single, unified scale.
# The print() function is used to force this plot to be displayed in the output.
# -------------------------------------------------------------------------
suppressMessages(
  suppressWarnings(
    print(ggplot(
      long_format_df %>% filter(financial_category == "total_revenue"),
      aes(x = year, y = amount, color = financial_category)
    ) +
      geom_line(linewidth = 1.2) +
      facet_wrap(~ state) +
      scale_color_manual(
        values = c("total_revenue" = "darkgreen"),
        labels = c("Total Revenue")
      ) +
      scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, prefix = "$", suffix = "B")) +
      labs(
        title = "State Financial Trends: Total Revenue",
        subtitle = "Trends in California, Texas, and New York from 1992 to 2016",
        x = "Year",
        y = "Amount (in Billions of US Dollars)",
        color = "Financial Category"
      ) +
      theme_minimal(base_size = 14) +
      theme(legend.position = "bottom")
  ))
)

# -------------------------------------------------------------------------
# Second Graph: Key Expenditures Trends
# This graph plots the three expenditure categories with a free y-axis scale.
# The print() function is also used here to ensure this plot is displayed.
# -------------------------------------------------------------------------
suppressMessages(
  suppressWarnings(
    print(ggplot(
      long_format_df %>% filter(financial_category != "total_revenue"),
      aes(x = year, y = amount, color = financial_category)
    ) +
      geom_line(linewidth = 1.2) +
      facet_wrap(~ state, scales = "free_y") +
      scale_color_manual(
        values = c("education_expenditure" = "blue",
                   "health_expenditure" = "red",
                   "correction_expenditure" = "orange"),
        labels = c("Education", "Health", "Correction")
      ) +
      scale_y_continuous(labels = scales::label_dollar(scale = 1e-9, prefix = "$", suffix = "B")) +
      labs(
        title = "State Financial Trends: Key Expenditures",
        subtitle = "Trends in California, Texas, and New York from 1992 to 2016",
        x = "Year",
        y = "Amount (in Billions of US Dollars)",
        color = "Financial Category"
      ) +
      theme_minimal(base_size = 14) +
      theme(legend.position = "bottom")
  ))
)

```

Based on the data present here, there is a clear big trend across all three of the states reviewed in the data set. Tax revenue across all states has increased year over year where California had a much larger spike in taxes than the other two states which is consistent with what is shown across different platforms. Another big trend is the expenditure in health care across all states, every state has increasingly spent more money on health care from 1992-2019, this is also consistent seeing as health care for most states is the largest industry and all states have a similar trend line, with this, it can be inferred that this will continue to grow as the years go on past 2019. What was interesting was the expenditure in education seemed to not follow the same pattern and grew very slowly but steadily, it appears that this could just be due to inflation but based on the data, there has not been a large push for expenditure on education. What was also interesting was that Texas towards later years has spent less on correction than they did on education whereas New York spent more on correction than they did on education which was surprising considering the states respective portrayals based on their politics.
